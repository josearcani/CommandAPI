trigger:
  - main

pool:
  name: DemoPool
  vmImage: "ubuntu-latest"

variables:
  buildConfiguration: "Release"

steps:
  - task: UseDotNet@2
  - script: dotnet build --configuration $(buildConfiguration)
    displayName: "dotnet build $(buildConfiguration)"

  - task: DotNetCoreCLI@2
    displayName: "dotnet test"
    inputs:
      command: test
      projects: "**/*Tests/*.csproj"
      testRunTitle: "xUNIT Test run"

  - task: DotNetCoreCLI@2
    displayName: "dotnet publish"
    inputs:
      command: publish
      projects: "src/CommandAPI/*.csproj"
      arguments: "--configuration $(builConfiguration) --output $(Build.ArtifactStagingDirectory)"

  - task: PublishBuildArtifacts@1
    displayName: "publish artifacts"
